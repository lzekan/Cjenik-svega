<!DOCTYPE html>
<html>

<head>
    <title>Profil</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="./styles/navbar.css">
    <link rel="stylesheet" type="text/css" href="./styles/profil.css">
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
</head>

<script type="text/javascript">
    function authHandler(req, res, next) {
    //ako korisnik nije logiran, redirekcija na osnovnu stranicu
        if (req.session.user === undefined) {
            console.log("Redirecting user to login");
            req.session.err = "Please login to view the requested page."
            req.session.save(() => {
                //redirekcija na osnovnu stranicu
                res.redirect("/login");
            });
        } else {
            console.log("User data present");
            next();
        }
    }
    module.exports = authHandler;
</script>

<body>

    <%- include('partials/navbar.ejs')%>

    <div class="container">
        <h1>
            <span class="profil">PROFIL</span>
        </h1>
        
        <div class="dataset">

            <div class="dataset-entry">
                <div class="dataset-property">
                    Korisniƒçko ime:
                </div>
                <div class="dataset-value">
                    <%= user.nickname %>
                </div>
                <form action="/changePrivacy" method="post">
                    <label for="nickname">Objavi javno:</label>
                    <input type="checkbox" id="nickname" name="nickname" 
                        <% if (user.privacy == undefined || user.privacy.is_nickname_public) { %>  checked  <% } else { %> unchecked <% } %>
                    >
                    <input type="hidden" name="attribute" value = "nickname">
                    <input type="hidden" name="user_id" value = "<%= user.id %>">
                    <button type="submit">Spremi promjene</button>
                    <br>
                </form>
            </div>

            <div class="dataset-entry">
                <div class="dataset-property">
                    Ime:
                </div>
                <div class="dataset-value">
                    <%= user.first_name %>
                </div>
                <form action="/changePrivacy" method="post">
                    <label for="first_name">Objavi javno:</label>
                    <input type="checkbox" id="first_name" name="first_name" 
                        <% if(user.privacy == undefined || user.privacy.is_first_name_public) { %>  checked  <% } else { %> unchecked <% } %>
                    >
                    <input type="hidden" name="attribute" value = "first_name">
                    <input type="hidden" name="user_id" value = "<%= user.id %>">
                    <button type="submit">Spremi promjene</button>
                    <br>
                </form>
            </div>

            <div class="dataset-entry">
                <div class="dataset-property">
                    Prezime:
                </div>
                <div class="dataset-value">
                    <%= user.last_name %>
                </div>
                <form action="/changePrivacy" method="post">
                    <label for="last_name">Objavi javno:</label>
                    <input type="checkbox" id="last_name" name="last_name" 
                    <%if (user.privacy == undefined || user.privacy.is_last_name_public) {%>  checked  <%} else {%> unchecked <%}%>
                    >
                    <input type="hidden" name="attribute" value = "last_name">
                    <input type="hidden" name="user_id" value = "<%= user.id %>">
                    <button type="submit">Spremi promjene</button>
                    <br>
                </form>
            </div>
            <div class="dataset-entry">
                <div class="dataset-property">
                    E-mail adresa:
                </div>
                <div class="dataset-value">
                    <%= user.email %>
                </div>
                <form action="/changePrivacy" method="post">
                    <label for="email">Objavi javno:</label>
                    <input type="checkbox" id="email" name="email" 
                    <%if (user.privacy == undefined || user.privacy.is_email_public) {%>  checked  <%} else {%> unchecked <%}%>
                    >
                    <input type="hidden" name="attribute" value = "email">
                    <input type="hidden" name="user_id" value = "<%= user.id %>">
                    <button type="submit">Spremi promjene</button>
                    <br>
                </form>
            </div>


        </div>

    </div>




</body>

</html>
