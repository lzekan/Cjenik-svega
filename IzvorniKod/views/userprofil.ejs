<!DOCTYPE html>
<html>

<head>
    <title>Profil</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="./vendor/normalize.css">
    <link rel="stylesheet" type="text/css" href="./styles/main.css">
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
</head>

<script type="text/javascript">
    function authHandler(req, res, next) {
    //ako korisnik nije logiran, redirekcija na osnovnu stranicu
    if (req.session.user === undefined) {
        console.log("Redirecting user to login");
        req.session.err = "Please login to view the requested page."
        req.session.save(() => {
            //redirekcija na osnovnu stranicu
            res.redirect("/login");
        });
    } else {
        console.log("User data present");
        next();
    }


}
module.exports = authHandler;
</script>

<body class="content">

    <header class="header primary-color-bg">
        <nav class="navigation container">
            <div class="menu">
                <a href="/" class="link menu-item <%if (linkActive === "home") {%>  link-active  <%}%>">Home</a>
                <a href="/logout" class="link menu-item <%if (linkActive === "logout") {%>  link-active  <%}%>">Logout</a>
                <a href="/prices" class="link menu-item <%if (linkActive === "prices") {%>  link-active  <%}%>">Cijene</a>
            </div>
        </nav>
    </header>


    <main class="main">
        <section class="section secondary-color-bg">
            <div class="container">
                <h1 class="decorated-title font-secondary main-color">
                    <span class="main-color-emphasized">Profil</span>
                </h1>
                <div class="dataset">

                    <div class="dataset-entry">
                        <div class="dataset-property">
                            User name
                        </div>
                        <div class="dataset-value">
                            <%= user.nickname %>
                        </div>
                        <form action="/changePrivacy" method="post">
                            <label for="nickname">Objavi javno:</label>
                            <input type="checkbox" id="nickname" name="nickname" 
                            <%if (user.privacy == undefined || user.privacy.is_nickname_public) {%>  checked  <%} else {%> unchecked <%}%>
                            >
                            <input type="hidden" name="attribute" value = "nickname">
                            <input type="hidden" name="user_id" value = "<%= user.id %>">
                            <button type="submit">Spremi promjene</button>
                            <br>
                        </form>
                    </div>

                    <div class="dataset-entry">
                        <div class="dataset-property">
                            First name
                        </div>
                        <div class="dataset-value">
                            <%= user.first_name %>
                        </div>
                        <form action="/changePrivacy" method="post">
                            <label for="first_name">Objavi javno:</label>
                            <input type="checkbox" id="first_name" name="first_name" 
                            <%if (user.privacy == undefined || user.privacy.is_first_name_public) {%>  checked  <%} else {%> unchecked <%}%>
                            >
                            <input type="hidden" name="attribute" value = "first_name">
                            <input type="hidden" name="user_id" value = "<%= user.id %>">
                            <button type="submit">Spremi promjene</button>
                            <br>
                        </form>
                    </div>

                    <div class="dataset-entry">
                        <div class="dataset-property">
                            Last name
                        </div>
                        <div class="dataset-value">
                            <%= user.last_name %>
                        </div>
                        <form action="/changePrivacy" method="post">
                            <label for="last_name">Objavi javno:</label>
                            <input type="checkbox" id="last_name" name="last_name" 
                            <%if (user.privacy == undefined || user.privacy.is_last_name_public) {%>  checked  <%} else {%> unchecked <%}%>
                            >
                            <input type="hidden" name="attribute" value = "last_name">
                            <input type="hidden" name="user_id" value = "<%= user.id %>">
                            <button type="submit">Spremi promjene</button>
                            <br>
                        </form>
                    </div>
                    <div class="dataset-entry">
                        <div class="dataset-property">
                            E-mail
                        </div>
                        <div class="dataset-value">
                            <%= user.email %>
                        </div>
                        <form action="/changePrivacy" method="post">
                            <label for="email">Objavi javno:</label>
                            <input type="checkbox" id="email" name="email" 
                            <%if (user.privacy == undefined || user.privacy.is_email_public) {%>  checked  <%} else {%> unchecked <%}%>
                            >
                            <input type="hidden" name="attribute" value = "email">
                            <input type="hidden" name="user_id" value = "<%= user.id %>">
                            <button type="submit">Spremi promjene</button>
                            <br>
                        </form>
                    </div>


                </div>

            </div>


            </section>
        </section>
    </main>


</body>

</html>
